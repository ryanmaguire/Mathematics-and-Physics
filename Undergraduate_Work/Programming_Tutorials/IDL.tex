\documentclass[crop=false,class=book]{standalone}
%----------------------------Preamble-------------------------------%
\input{../../preamble.tex}
%--------------------------Main Document----------------------------%
\begin{document}
\chapter{IDL}
    \section{Tutorials}
    \subsection{Introduction}
        Summing down an $n\times{m}$ matrix into an $m$ element
        long vector is quicker using total(a,2), rather than using
        a for loop over total(a).
        \newline
        \begin{minipage}[t]{.48\textwidth}
            \centering
            \begin{lstlisting}[%
                language=IDL,
                basicstyle=\small\ttfamily,
                frame=single,
                gobble=16
            ]
                a = DBLARR(25600,25600)
                b = DBLARR(25600)
                t1 = SYSTIME(/seconds)
                FOR i=0,25600-1 DO b[i]=TOTAL(a[i,*])
                t2 = SYSTIME(/seconds)

                t3 = SYSTIME(/seconds)
                b = TOTAL(a,2)
                t4 = SYSTIME(/seconds)

                PRINT, t2-t1, t4-t3
                END
            \end{lstlisting}
        \end{minipage}\hfill
        \begin{minipage}[t]{.48\textwidth}
            \centering
            \begin{lstlisting}[%
                language=bash,
                basicstyle=\small\ttfamily,
                frame=single,
                caption=output,
                gobble=16
            ]
                IDL> .run test.pro
                        26.816771   12.986878
            \end{lstlisting}
        \end{minipage}
    \subsection{NAIF ICY Examples}
        \subsubsection{Converting Between B1950 and J2000}
            \begin{lstlisting}[%
                language=IDL,
                basicstyle=\small\ttfamily,
                frame=single,
                escapechar=",
                gobble=16
            ]
                ; Import NAIF Leap Second counter.
                CSPICE_furnsh, 'naif0012.tls'

                ; Create Transformation matrix from B2950 to J2000
                CSPICE_pxform, 'B1950', 'J2000', 0., matrix

                ; Saturn's Pole in 1981 had RA=38.409 and DEC=83.324,"%
                " in the B1950 system.
                ; Create a unit vector pointing in the direction,"%
                "of Saturn's pole.
                CSPICE_radrec, 1.d0, 38.409d0*CSPICE_rpd(),"%
                    " 83.324d0*CSPICE_rpd(), nhat

                ; Get unit vector in the J2000 coordinates.
                nhat2 = matrix##nhat

                ; Make nhat2 into a vector.
                nhat2 = reform(nhat2)

                ; Convert unit vector to RA and DEC in J2000.
                CSPICE_recrad, nhat2, r, RA, DEC
                END
            \end{lstlisting}
        \subsubsection{Retrieving State Vectors and Light Time Values}
            \begin{lstlisting}[%
                language=bash,
                basicstyle=\small\ttfamily,
                frame=single,
                caption=output,
                gobble=16,
                escapechar="
            ]
                ; Create array of 1000 ephemeris times with step size
                ; of 10 hours, starting July 1, 2005.
                cspice_str2et, 'July 1, 2005', start
                et = dindgen( 1000 )*36000.d + start

                ; Retrieve the state vectors and corresponding light"%
                  " times for Mars to Earth
                ; at each ET in the J2000 frame using"%
                  " the LT+S aberration correction.
                cspice_spkezr, 'Earth', et, 'J2000', 'LT+S',"%
                " 'MARS', state, ltime
    
                ; access the ith state 6-vector corresponding to"%
                  " the ith et.
                state_i = state[*,i]

                ; Convert the et vector from the previous example to"%
                  " UTC calendar strings.
                format = 'C'
                prec = 3
                cspice_et2utc, et, format, prec, utcstr

                ; Access the ith string of utcstr.
                utcstr_i = utcstr[i]

                ; Convert position components of the N state vectors to"%
                  " latitudinal coordinates.
                cspice_reclat, state[0:2,*], radius, latitude, longitude
                ; This returns three double precision variables: radius, latitude, longitude.
            \end{lstlisting}
        \subsubsection{Calculate and Plot the Trajectory of Cassini in J2000}
        \begin{lstlisting}[language=bash,basicstyle=\footnotesize] 
        ;Load the following kernels.
        IDL> cspice_furnsh, 'naif0012.tls'
        IDL> cspice_furnsh, 'de421.bsp'
        IDL> cspice_furnsh, 'pck00010.tpc'
        IDL> cspice_furnsh, '030201AP_SK_SM546_T45.bsp' 
        ;Define the number of divisions of the time interval and the time interval.
        IDL> STEP = 10000
        IDL> utc = [ 'Jun 20, 2004', 'Dec 1, 2005' ]
        IDL> cspice_str2et, utc, et
        IDL> times = dindgen(STEP)*(et[1]-et[0])/STEP + et[0]
        IDL> cspice_spkpos, 'Cassini', times, 'J2000', 'NONE', 'SATURN BARYCENTER', pos, ltime
        ;Plot the resulting trajectory.
        IDL> x = pos[0,*]
        IDL> y = pos[1,*]
        IDL> z = pos[2,*]
        IDL> iplot, x, y, z
        IDL> cspice_kclear
        \end{lstlisting}
\end{document}